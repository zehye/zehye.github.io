---
layout: post
title: SQL 기본문법 > JOIN(CROSS, INNER, OUTER, SELF)
category: SQL
tags: [SQL]
comments: true
---

> 개인공부 후 자료를 남기기 위한 목적임으로 내용 상에 오류가 있을 수 있습니다.    

<hr>


## JOIN

하나의 테이블에 원하는 데이터가 모두 있다면 좋겠지만, 두 개의 테이블을 엮어야 원하는 결과가 나오는 경우도 많다. 이때 조인을 쓰면 두개의 테이블을 엮어 원하는 데이터를 추출할 수 있게 한다. 즉 조인이란, 

1. 두 개 이상의 테이블을 연결하여 데이터를 검색하는 방법
2. 서로 다른 테이블에 저장된 데이터를 함께 가져와 하나의 결과로 표시함
3. 검색하고 싶은 컬럼이 서로 다른 테이블에 있을 때 사용
4. 조인을 사용해 여러개의 테이블을 마치 하나의 테이블처럼 사용 가능


**조인 방식**

- ANSI SQL
    - FROM 절 안의 두 테이블 사이에 조인 종류(CROSS, INNER, OUTER)에 따라 JOIN 키워드를 넣어줌
    - ON 절에 조인에 대한 조건을 작성하고 나머지 조건은 WHERE 절에 작성
    - CROSS, INNER, OUTER 키워드는 생략 가능

- Non-ANSI SQL
    - FROM 절에 테이블을 쉼표로 구분해 작성
    - 조인조건, 기타조건을 구분없이 WHERE절에 작성 



### CROSS JOIN

한 쪽 테이블의 각 행마다 다른 쪽 테이블의 모든 행이 각각 한번씩 매칭되는 조인 (Caresian Product)

<center>
<figure>
<img src="/assets/post-img/SQL/6.png" alt="" width="50%">
</figure>
</center>


```sql 
-- 문제1: 사원테이블과 부서테이블을 조인하여 배재용 사원에 대한 정보를 보이시오
-- 이름, 사원테이블의 부서번호, 부서테이블의 부서번호, 부서명
SELECT 사원.이름, 사원.부서번호, 부서.부서번호, 부서.부서명 FROM 사원 JOIN 부서
ON 사원.이름 = '배재용'; 

SELECT 사원.이름, 사원.부서번호, 부서.부서번호, 부서.부서명 FROM 사원,부서
WHERE 사원.이름 = '배재용'; 
```


### INNER JOIN

각 테이블에서 조인 조건에 일치되는 데이터만 가져오는 조인

여러 테이블을 사용할 때 조인조건을 제대로 기술하지 않으면 크로스조인을 한 결과가 나온다 

<center>
<figure>
<img src="/assets/post-img/SQL/5.png" alt="" width="50%">
</figure>
</center>


```sql 
-- 문제1: 이소미 사원의 사원번호, 직위, 부서번호, 부서명을 보이시오
SELECT 사원.이름, 사원.사원번호, 사원.직위, 부서.부서번호, 부서.부서명 FROM 사원 INNER JOIN 부서 
ON 사원.부서번호 = 부서.부서번호  -- 공통된 컬럼이 있으니까 INNER JOIN이 가능
WHERE 사원.이름 = '이소미';

-- 문제2: 고객 회사들이 주문한 주문건수를 주문건수가 많은 순서대로 보이시오
-- 이때 고객회사의 정보로 고객번호, 담당자명, 고객회사명을 보이시오
SELECT 고객.고객번호, 고객.담당자명, 고객.고객회사명, count(*) 주문건수 FROM 고객 INNER JOIN 주문
ON 고객.고객번호 = 주문.고객번호 
GROUP BY 1
ORDER BY 주문건수 desc;

-- 문제3: 고객별 주문금액 합을 보이되, 주문 금액 합이 많은 순서대로 보이시오
-- 이때 고객회사의 정보로 고객번호, 담당자명, 고객회사명을 보이시오
SELECT 고객.고객번호, 고객.담당자명, 고객.고객회사명, SUM(주문수량*단가) 주문합  
FROM 고객 
INNER JOIN 주문
ON 고객.고객번호 = 주문.고객번호 
INNER JOIN 주문세부
ON 주문.주문번호 = 주문세부.주문번호 
GROUP BY 1
ORDER BY 주문합 desc;

-- 문제4: 고객 테이블에서 담당자가 이은광인 경우 
-- 고객번호, 고객회사명, 담당자명, 마일리지와 마일리지 등급을 보이시오
SELECT 고객.고객번호, 고객.담당자명, 고객.마일리지, 마일리지, 등급명  
FROM 고객 
INNER JOIN 마일리지등급 M  -- alias 
ON 마일리지등급 BETWEEN 하한마일리지 AND 상한마일리지  -- 이렇게 join에 대한 조건 작성 가능 
WHERE 담당자명 = '이은광';
```


### OUTER JOIN

조건이 맞지 않는 행도 함께 출력할 수 있음. 외부 조긴은 두 테이블에서 한쪽에는 데이터가 있고, 한쪽에는 없는 경우 데이터가 있는 쪽의 테이블을 기준으로 데이터를 출력한다. MySQL에서 외부조긴은 ANSI SQL 방식으로만 표현 가능 



<center>
<figure>
<img src="/assets/post-img/SQL/4.png" alt="" width="50%">
</figure>
</center>

**OUTER**는 생략가능

- LEFT JOIN
    - 왼쪽에 있는 테이블의 결과를 기준으로 오른쪽 테이블 데이터 매칭
    - 매칭되는 데이터가 없는 경우에는 null로 표시

- RIGHT JOIN
    - 오른쪽에 있는 테이블의 결과를 기준으로 왼쪽 테이블 데이터 매칭
    - 매칭되는 데이터가 없는 경우에는 null로 표시


```sql 
-- 문제1: 정리 에정
```